<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Justice City Viewer</title>

  <!-- Cesium CSS -->
  <link rel="stylesheet"
        href="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Widgets/widgets.css">

  <style>
    html, body, #cesiumContainer { width:100%; height:100%; margin:0; padding:0; }
    /* Page background (outside the globe) */
    body { background:#0b1a2b; }

    /* On-screen message if something fails */
    #msg {
      position:absolute; top:10px; left:10px;
      background:rgba(0,0,0,.65); color:#fff;
      padding:8px 10px; font:14px system-ui, sans-serif;
      border-radius:6px; display:none;
    }
  </style>

  <!-- Tell Cesium where to load its assets -->
  <script>
    window.CESIUM_BASE_URL = "https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/";
  </script>

  <!-- Cesium JS -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Cesium.js"></script>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="msg"></div>

  <script>
    // 1) Your Cesium ion token (keep the quotes)
    Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMTJhNDRjOS0yMGQ0LTQ3MTctODI0OC00NjBmNTJhZDg2MTgiLCJpZCI6MzM2ODExLCJpYXQiOjE3NTcwMTMyMTR9.zRV7TVzrkTXHHEdqQFJMqqO33PoBHTLtbpy3unjefHc";

    // 2) Create the viewer with REAL terrain, no imagery
    const viewer = new Cesium.Viewer("cesiumContainer", {
      terrainProvider: Cesium.createWorldTerrain(),   // <-- ground elevation
      timeline: false,
      animation: false,
      geocoder: false,
      baseLayerPicker: false,  // we’re controlling layers ourselves
      sceneModePicker: true
    });

    // Remove ALL imagery for a clean, plain globe
    viewer.imageryLayers.removeAll();
    // Set the land color you want (light neutral looks map-like without tiles)
    viewer.scene.globe.baseColor = Cesium.Color.fromCssColorString("#dfe3ea"); // tweak to taste
    // Keep the sky; if you want a flat background instead, uncomment the next two lines:
    // viewer.scene.skyBox = new Cesium.SkyBox({ show: false });
    // viewer.scene.skyAtmosphere.show = false;

    // 3) Load your 3D Tileset
    (async () => {
      try {
        const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(3691052);
        viewer.scene.primitives.add(tileset);
        await tileset.readyPromise;

        // Fly to your data
        viewer.zoomTo(tileset);

        // ---- Optional: tiny height nudge (useful if you want millimeter-perfect sit) ----
        let heightOffset = 0; // meters
        async function setHeight(offsetMeters) {
          heightOffset = offsetMeters;
          const center = tileset.boundingSphere.center;
          const carto = Cesium.Cartographic.fromCartesian(center);
          const surface = Cesium.Cartesian3.fromRadians(carto.longitude, carto.latitude, 0.0);
          const offset = Cesium.Cartesian3.fromRadians(carto.longitude, carto.latitude, heightOffset);
          const translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());
          tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);
        }
        // Keyboard: [ down 1m, ] up 1m, { down 10m, } up 10m
        window.addEventListener("keydown", (e) => {
          if (e.key === "]") setHeight(heightOffset + 1);
          if (e.key === "[") setHeight(heightOffset - 1);
          if (e.key === "}") setHeight(heightOffset + 10);
          if (e.key === "{") setHeight(heightOffset - 10);
        });
        // Start with no offset; adjust if you see any tiny float
        setHeight(0);
      } catch (err) {
        console.error(err);
        const m = document.getElementById("msg");
        m.textContent = (err && (err.message || err.statusText)) || "Couldn’t load dataset.";
        m.style.display = "block";
      }
    })();
  </script>
</body>
</html>
